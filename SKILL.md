---
name: bilibili-dialogue-transcript
description: B站（Bilibili）名师视频学习技能。Given a BV id or URL, produce teaching-ready documents. The transcript is generated by script; lesson plan and observation notes are written by the LLM after reading the full transcript. Dialogue refinement is optional.
---

# B站（Bilibili）名师视频学习技能

## Overview
Convert a Bilibili video into teaching-ready documents:
1. `原始字幕` — generated by script (timestamped, no speaker labels)
2. `通顺增强对话稿` — generated by script (rule-based speaker labelling + punctuation)
3. `教案` — written by LLM after reading the transcript
4. `听课记录（学习者视角）` — written by LLM after reading the transcript
5. *(可选)* `对话稿（优化版）` — LLM refines speaker labels using semantic context

## When To Use
Use this skill when the request includes one of these goals:
- Convert Bilibili BV/URL into text.
- Convert subtitle lines into dialogue format (`老师/学生/全班`).
- Produce `教案` or `听课记录` from a Bilibili masterclass video.

## Workflow

### Step 1: Run the script to fetch subtitle and generate rough dialogue transcript
```bash
python scripts/process_bilibili_dialogue.py <BV_ID_OR_URL> --outdir <workspace_root>
```

The script prints a single line to stdout:
```
RESULT_JSON:{"bvid":...,"title":...,"cid":...,"base_name":...,"files":{"raw_subtitle":"<path>","dialogue_verbatim_smooth":"<path>"}}
```
Parse this line to get `base_name`, `title`, and file paths.
Do **not** look for a separate `RESULT_JSON` file on disk — no such file is created.

Output files are saved to `bili_temp/<base_name>/` (Chinese directory name derived from video title).

### Step 2: Read the dialogue transcript
Use the Read tool to load the `通顺增强对话稿.txt` file.
The file is typically 15,000–25,000 characters for a 40-minute lesson — well within context.

### Step 3: Write the 教案 (Lesson Plan)
Based on the actual transcript content, write a lesson plan in Chinese to:
`bili_temp/<base_name>/<base_name>教案.md`

Required sections:
- 一、课题与课型（课题、学段、课型、来源视频、课时）
- 二、为什么这节课值得学（从对话稿中提炼3-5条真实亮点，引用具体课堂话语）
- 三、教学目标（知识与技能 / 过程与方法 / 思维与表达，可评估）
- 四、教学重点与难点
- 五、教学流程（按课堂实际推进顺序，每阶段含：阶段名、核心任务、关键教师话语原文引用、学生反应）
- 六、可直接借鉴的名师做法（具体到话语动作，不写泛泛评语）
- 七、板书建议（从对话稿还原实际板书脉络）

Writing standards:
- Every claim must be grounded in the transcript — quote actual teacher/student utterances
- No generic filler ("教师用提问推动思考" without specifics)
- Stage names and time estimates derived from transcript structure, not fixed templates

### Step 4: Write the 听课记录 (Observation Notes)
Based on the actual transcript content, write observation notes in Chinese to:
`bili_temp/<base_name>/<base_name>听课记录.md`

Required sections:
- 一、听课定位（观课目的、关注主线）
- 二、课堂基本信息（课题、来源视频）
- 三、关键课堂片段与学习发现
  - For each major stage: 课堂片段原文（直接引用对话稿2-4句）、我看到的教学智慧（具体分析）、我可迁移的做法（可操作的具体行动）
- 四、评语（学习者立场，基于本课实际内容）
- 五、我的后续行动计划（3条具体可执行行动）

Writing standards:
- 课堂片段必须直接引用对话稿原文，不得改写或概括
- 教学智慧分析针对本节课，不写放之四海皆准的空话
- 可迁移做法要具体到"在什么情境下做什么动作"

### Step 5: Report results
Tell the user the file paths and give a 3-sentence summary of what makes this particular lesson worth studying.

### Step 6 *(可选)*: Refine the dialogue transcript
**Only execute this step when the user explicitly requests dialogue optimization.**

Read both `原始字幕.txt` (timestamped, no speaker labels) and `通顺增强对话稿.txt` (rough labels). Compare them and produce a refined version saved to:
`bili_temp/<base_name>/<base_name>对话稿（优化版）.md`

What to fix:
- Teacher's question misattributed to student (keyword-based rules misfire)
- Student answer misattributed to teacher (short answers default to teacher mode)
- Same speaker's continuous speech split into alternating labels
- "全班" over-triggered or missed

How to fix:
- Use semantic context: question–answer pairs, discourse markers, instructional tone vs. response tone
- Use timestamps: very short gaps usually mean same speaker continues
- Preserve `老师：` / `学生：` / `全班：` format; merge consecutive same-speaker lines
- Add proper punctuation; remove subtitle artifacts
- Do NOT change the actual words spoken

## Time Range Filtering

The script supports `--start` and `--end` parameters to process only a portion of the video:
```bash
python scripts/process_bilibili_dialogue.py <BV_ID> --outdir <workspace_root> --start 0 --end 4800
```
- `--start`: start time in seconds (default: 0)
- `--end`: end time in seconds (default: 0 = entire video)
- Subtitle items are filtered by their `from` timestamp (inclusive start, exclusive end)

This is useful when processing only a portion of a video (e.g., used by `bilibili-mixed-training` skill for mixed-content videos).

## Notes
- Subtitle source uses `x/v2/dm/view` for better consistency.
- If subtitle is missing, return a clear error and ask for another video.
- Keep original files; write new derived files instead of overwriting user-edited files.
- The `通顺增强对话稿.txt` uses rule-based speaker labelling — attribution may occasionally be wrong. Use judgment when quoting.
- All output files go to `bili_temp/<base_name>/` where `<base_name>` is a Chinese name derived from the video title.
- This skill is designed to work with any LLM that can follow instructions, read files, and write files.
- For mixed-content videos (classroom + lecture), use `bilibili-mixed-training` skill instead.
